name: 每日证券早报 (News Digest)

on:
  schedule:
    # 北京时间 09:00 = UTC 01:00
    - cron: '0 1 * * *'
  workflow_dispatch: # 允许手动触发测试

jobs:
  news_digest:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run News Digest
      env:
        # 复用原项目中已配置的 Secrets [2, 4, 5]
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        OPENAI_BASE_URL: ${{ secrets.OPENAI_BASE_URL }}
        TAVILY_API_KEYS: ${{ secrets.TAVILY_API_KEYS }}
        BOCHA_API_KEYS: ${{ secrets.BOCHA_API_KEYS }}
        EMAIL_SENDER: ${{ secrets.EMAIL_SENDER }}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        EMAIL_RECEIVERS: ${{ secrets.EMAIL_RECEIVERS }}
        # 如果代码中用到其他配置，确保这里引用
      run: |
        python news_digest.py
